var b=(s=[])=>{let r=(...e)=>console.warn(...e),n=new Map(s);return{clear:()=>n.clear(),delete:e=>{if(n.has(e)){let o=n.get(e);return o.forEach(c=>{let d=n.get(c);d.delete(e),d.size||n.delete(c)}),n.delete(e),o}},remove:e=>o=>{if(n.has(e)){let c=n.get(e);c.delete(o),c.size||n.delete(e)}if(n.has(o)){let c=n.get(o);c.delete(e),c.size||n.delete(o)}},size:()=>n.size,has:e=>{if(n.has(e)){let o=n.get(e);return c=>new Set(o).has(c)}return!1},get:e=>n.has(e)?new Set(n.get(e)):void 0,set:e=>o=>{n.has(e)?n.get(e).add(o):n.set(e,new Set([o])),n.has(o)?n.get(o).add(e):n.set(o,new Set([e]))},nodes:()=>new Set(n.keys()),edges:()=>{let e=[];return n.forEach((o,c)=>o.forEach(d=>e.push([c,d]))),e},tidy:()=>{n.entries().map(([e,o])=>{loop(c=>{n.has(c)?n.get(c).has(e)||r("non-bidirectional | exists in set, not in map: ",e):r("non-bidirectional | exists in map, not in set: ",c)})(o)})}}};var i=s=>r=>{for(let n of r)s(n)};var f=s=>({children:(r,n="*")=>[...r.children][s](e=>e.matches(n)),siblings:(r,n="*")=>[...r.parentElement.children][s](e=>e.matches(n))});f.index=(s,r)=>extendQSA.children(s,r).indexOf(s);var g=Object.assign((s,r=document)=>r.querySelectorAll(s),f("filter")),x=Object.assign((s,r=document)=>r.querySelector(s),f("find")),h=s=>s.tagName?s:s.parentElement,N=(s,...r)=>s(...r);var D=(s,r)=>{if(s===r)return 0;var n=s.compareDocumentPosition(r);return n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS?1:0},y=s=>("sort"in s?s:[...s]).sort(D);var z=async s=>{let r={root:s.root||document,scheduleInit:s.scheduleInit||(t=>addEventListener("DOMContentLoaded",t,{once:!0})),scheduleQueue:s.scheduleQueue||(t=>t())},n={attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0},e={graph:b(),match:new Set,query:new Set,queue:new Set,after:new Set,plugins:new Set(s.plugins||[]),allSelect:""},o=()=>{e.allSelect=[...e.plugins].map(t=>t.select).join()},c=()=>{e.match.clear(),e.query.clear(),e.queue.clear(),e.after.clear()},d=t=>()=>{t.isConnected||(i(a=>e.graph.delete(a))(g("*",t)),e.graph.delete(t))},S=t=>{let a=e.graph.get(t);!a||(i(l=>l.update(t))(a),e.after.add(d(t)))},m=({parentElement:t})=>{!t||e.queue.has(t)||(m(t),e.graph.has(t)&&e.queue.add(t))},E=t=>a=>{let l=t.matches(a.select),u=e.graph.has(a,t);u!==l&&(l?e.graph.set(a)(t):e.after.add(()=>{e.graph.remove(a)(t)})),(u||l)&&e.queue.add(t)},I=t=>[...e.plugins].map(E(t)),A=t=>{(t.matches(e.allSelect)||e.graph.has(t))&&e.match.add(t),i(a=>e.match.add(a))(g(e.allSelect,t)),i(a=>e.graph.has(a)&&e.match.add(a))(g("*",t))},w=()=>{i(A)(e.query),i(I)(e.match),i(m)(e.queue),i(S)(y(e.queue)),i(N)(e.after),c()},p=i(t=>{let a=h(t);a&&e.query.add(a)}),C=t=>{t.type==="attributes"&&(e.match.add(h(t.target)),t.attributeName in Object.getPrototypeOf(t.target)||delete t.target[t.attributeName]),t.addedNodes.length&&p(t.addedNodes),t.removedNodes.length&&p(t.removedNodes),e.match.add(h(t.target))},T=t=>{!e.allSelect||(i(C)(t),r.scheduleQueue(w))},P=new MutationObserver(T),j=t=>a=>{e.graph.set(t)(a),t.update(a)},O=t=>t.select&&i(j(t))(g(t.select,r.root)),q=()=>{let l=Object.assign(u=>[...e.graph.get(u)],{add:u=>{e.plugins.add(u),O(u)},clear:()=>{c(),e.graph.clear()},delete:u=>{e.plugins.delete(u),e.graph.delete(u)},plugins:()=>[...e.plugins],has:u=>e.graph.has(u)});return s.debug?Object.assign(l,{debug:e}):l},M=async t=>{i(O)(e.plugins),o(),P.observe(r.root,n),t(q())};return new Promise(t=>r.scheduleInit(()=>M(t)))};export{z as onDom};
//# sourceMappingURL=ondom.js.map
