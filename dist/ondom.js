var O=(s=[])=>{let o=(...e)=>console.warn(...e),n=new Map(s);return{clear:()=>n.clear(),delete:e=>{if(n.has(e)){let r=n.get(e);return r.forEach(a=>{let l=n.get(a);l.delete(e),l.size||n.delete(a)}),n.delete(e),r}},remove:e=>r=>{if(n.has(e)){let a=n.get(e);a.delete(r),a.size||n.delete(e)}if(n.has(r)){let a=n.get(r);a.delete(e),a.size||n.delete(r)}},size:()=>n.size,has:e=>{if(n.has(e)){let r=n.get(e);return a=>new Set(r).has(a)}return!1},get:e=>n.has(e)?new Set(n.get(e)):void 0,set:e=>r=>{n.has(e)?n.get(e).add(r):n.set(e,new Set([r])),n.has(r)?n.get(r).add(e):n.set(r,new Set([e]))},nodes:()=>new Set(n.keys()),edges:()=>{let e=[];return n.forEach((r,a)=>r.forEach(l=>e.push([a,l]))),e},tidy:()=>{n.entries().map(([e,r])=>{loop(a=>{n.has(a)?n.get(a).has(e)||o("non-bidirectional | exists in set, not in map: ",e):o("non-bidirectional | exists in map, not in set: ",a)})(r)})}}};var i=s=>o=>{for(let n of o)s(n)};var h=(s,o=document)=>o.querySelectorAll(s);var g=s=>s.tagName?s:s.parentElement,S=(s,...o)=>s(...o),_=()=>{},j=(s,o=_)=>(...n)=>{try{return s(...n)}catch(e){return o(e,...n)}};var v=(s,o)=>{if(s===o)return 0;var n=s.compareDocumentPosition(o);return n&Node.DOCUMENT_POSITION_FOLLOWING||n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS?1:0},N=s=>("sort"in s?s:[...s]).sort(v),F=(...s)=>{let[o,n,e]=s;return{1:()=>{let r={};return i(a=>{r[a.name]=a.value})(o.attributes),r},2:()=>o.getAttribute(n),3:()=>o.setAttribute(n,e)}[s.length]()},p=(s,...o)=>(n,...e)=>{if(!(s in n)){let r=Function(...o,n.getAttribute(s)).bind(n);n[s]=r}return n[s](...e)},Q=(s,o)=>n=>(s in n||(n[s]=Function("maybe","obj",`return maybe(() => obj${path.startsWith(/\.\[/)?path:"."+path});`)(j,o)),n[s]),U={event:s=>o=>p(s,"event")(o.target,o),entry:s=>o=>p(s,"entry")(o.target,o),js:p,resolve:Q},G=Object.assign(F,U);var H=async s=>{let o={root:s.root||document,scheduleInit:s.scheduleInit||(t=>addEventListener("DOMContentLoaded",t,{once:!0})),scheduleQueue:s.scheduleQueue||(t=>t())},n={attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0},e={graph:O(),match:new Set,query:new Set,queue:new Set,after:new Set,plugins:new Set(s.plugins||[]),allSelect:""},r=()=>{e.allSelect=[...e.plugins].map(t=>t.select).join()},a=()=>{e.match.clear(),e.query.clear(),e.queue.clear(),e.after.clear()},l=t=>()=>{t.isConnected||(i(c=>e.graph.delete(c))(h("*",t)),e.graph.delete(t))},y=t=>{let c=e.graph.get(t);!c||(i(d=>d.update(t))(c),e.after.add(l(t)))},f=({parentElement:t})=>{!t||e.queue.has(t)||(f(t),e.graph.has(t)&&e.queue.add(t))},E=t=>c=>{let d=t.matches(c.select),u=e.graph.has(c,t);u!==d&&(d?e.graph.set(c)(t):e.after.add(()=>{e.graph.remove(c)(t)})),(u||d)&&e.queue.add(t)},I=t=>[...e.plugins].map(E(t)),q=t=>{(t.matches(e.allSelect)||e.graph.has(t))&&e.match.add(t),i(c=>e.match.add(c))(h(e.allSelect,t)),i(c=>e.graph.has(c)&&e.match.add(c))(h("*",t))},w=()=>{i(q)(e.query),i(I)(e.match),i(f)(e.queue),i(y)(N(e.queue)),i(S)(e.after),a()},m=i(t=>{let c=g(t);c&&e.query.add(c)}),T=t=>{t.type==="attributes"&&(e.match.add(g(t.target)),t.attributeName in Object.getPrototypeOf(t.target)||delete t.target[attributeName]),t.addedNodes.length&&m(t.addedNodes),t.removedNodes.length&&m(t.removedNodes),e.match.add(g(t.target))},A=t=>{!e.allSelect||(i(T)(t),o.scheduleQueue(w))},M=new MutationObserver(A),C=t=>c=>{e.graph.set(t)(c),t.update(c)},b=t=>t.select&&i(C(t))(h(t.select,o.root)),D=()=>{let d=Object.assign(u=>[...e.graph.get(u)],{add:u=>{e.plugins.add(u),b(u)},clear:()=>{a(),e.graph.clear()},delete:u=>{e.plugins.delete(u),e.graph.delete(u)},has:u=>e.graph.has(u)});return s.debug?Object.assign(d,{debug:e}):d},P=async t=>{i(b)(e.plugins),r(),M.observe(o.root,n),t(D())};return new Promise(t=>o.scheduleInit(()=>P(t)))};export{H as onDom};
//# sourceMappingURL=ondom.js.map
