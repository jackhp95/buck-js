var w=(s=[])=>{let o=(...e)=>console.warn(...e),t=new Map(s);return{clear:()=>t.clear(),delete:e=>{if(t.has(e)){let r=t.get(e);return r.forEach(a=>{let i=t.get(a);i.delete(e),i.size||t.delete(a)}),t.delete(e),r}},remove:e=>r=>{if(t.has(e)){let a=t.get(e);a.delete(r),a.size||t.delete(e)}if(t.has(r)){let a=t.get(r);a.delete(e),a.size||t.delete(r)}},size:()=>t.size,has:e=>{if(t.has(e)){let r=t.get(e);return a=>new Set(r).has(a)}return!1},get:e=>t.has(e)?new Set(t.get(e)):void 0,set:e=>r=>{t.has(e)?t.get(e).add(r):t.set(e,new Set([r])),t.has(r)?t.get(r).add(e):t.set(r,new Set([e]))},nodes:()=>new Set(t.keys()),edges:()=>{let e=[];return t.forEach((r,a)=>r.forEach(i=>e.push([a,i]))),e},tidy:()=>{t.entries().map(([e,r])=>{loop(a=>{t.has(a)?t.get(a).has(e)||o("non-bidirectional | exists in set, not in map: ",e):o("non-bidirectional | exists in map, not in set: ",a)})(r)})}}};var u=s=>o=>{for(let t of o)s(t)},v=s=>(console.log(s),s),f=(s,o=document)=>o.querySelectorAll(s),N=s=>s.tagName?s:s.parentElement,I=(s,...o)=>s(...o),Q=(s,o)=>async(...t)=>{performance.mark("a");let e=typeof s?.then=="function"?await s(...t):s(...t);return performance.mark("b"),performance.measure(o||s.name,"a","b"),u(console.log)(performance.getEntriesByType("measure")),e},U=(s,o)=>{if(s===o)return 0;var t=s.compareDocumentPosition(o);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0},y=s=>("sort"in s?s:[...s]).sort(U);var G=async s=>{let o={root:s.root||document,scheduleInit:s.scheduleInit||(n=>addEventListener("DOMContentLoaded",n,{once:!0})),scheduleQueue:s.scheduleQueue||(n=>n())},t={attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0},e={graph:w(),match:new Set,query:new Set,queue:new Set,after:new Set,plugins:new Set(s.plugins||[]),allSelect:"*"},r=()=>{e.allSelect=[...e.plugins].map(n=>n.select).join()},a=()=>{e.match.clear(),e.query.clear(),e.queue.clear(),e.after.clear()},i=n=>()=>{n.isConnected||(u(c=>e.graph.delete(c))(f("*",n)),e.graph.delete(n))},m=n=>{let c=e.graph.get(n);!c||(u(p=>p.update(n))(c),e.after.add(i(n)))},l=({parentElement:n})=>{!n||e.queue.has(n)||(l(n),e.graph.has(n)&&e.queue.add(n))},g=n=>c=>{let p=n.matches(c.select),d=e.graph.has(c,n);d!==p&&(p?e.graph.set(c)(n):e.after.add(()=>{e.graph.remove(c)(n)})),(d||p)&&e.queue.add(n)},O=n=>[...e.plugins].map(g(n)),E=n=>{(n.matches(e.allSelect)||e.graph.has(n))&&e.match.add(n),u(c=>e.match.add(c))(f(e.allSelect,n)),u(c=>e.graph.has(c)&&e.match.add(c))(f("*",n))},C=()=>{u(E)(e.query),u(O)(e.match),u(l)(e.queue),u(m)(y(e.queue)),u(I)(e.after),a()},M=u(n=>{let c=N(n);c&&e.query.add(c)}),D=n=>{n.type==="attributes"&&e.match.add(N(n.target)),n.addedNodes.length&&M(n.addedNodes),n.removedNodes.length&&M(n.removedNodes),e.match.add(N(n.target))},P=n=>{u(D)(n),o.scheduleQueue(C)},x=new MutationObserver(P),F=n=>c=>{e.graph.set(n)(c),n.update(c)},T=n=>u(F(n))(f(n.select,o.root)),_=()=>{let p=Object.assign(d=>[...e.graph.get(d)],{add:d=>{e.plugins.add(d),T(d)},clear:()=>{a(),e.graph.clear()},delete:d=>{e.plugins.delete(d),e.graph.delete(d)},has:d=>e.graph.has(d)});return s.debug?Object.assign(p,{debug:e}):p},j=async n=>{u(T)(e.plugins),r(),x.observe(o.root,t),n(_())};return new Promise(n=>o.scheduleInit(()=>j(n)))};var b=(s,o)=>new Proxy(s,{get:(t,e)=>o[e].bind(o),apply:function(t,e,r){return s(...r)}}),S=new Map;function q(s){S.has(s)||S.set(s,new Map);let o=S.get(s);return b(e=>{o.has(e)||o.set(e,new Map);let r=o.get(e);return b((i,m)=>{let l=S.get(e),g=(...O)=>{let E=l.has(i)?m(l.get(i),O):O;l.set(i,E)};return s(e,l),b(g,l)},r)},o)}var z=(s,o)=>s(()=>{let t=([e,r])=>e(...r);o.entries().forEach(t),o.clear()}),L=q(z),A=(s,o)=>{s(()=>{let[t,e]=o.entries().next().value;t(...e),o.delete(t),A(s,o)})},k=q(A),h=s=>o=>{let t={fn:o,canceled:!1};return t.cancel=()=>t.canceled=!0,t.throttler=e=>{t.throttle=()=>{t.throttled||(e(()=>t.throttled=!1)(),t.throttled=!0)}},function(...e){t.args=e,t.debounce&&(t.debounce=Date.now()),t.callback=()=>t.fn(...t.args);let r=(m,l)=>[t.canceled,t.throttled,t.debounce&&t.debounce!==m,()=>l(t.callback())].find(g=>g),a=m=>l=>{let g=[r(m,l),t];g.length=s.length,s(...g)};t.throttle&&t.throttle();let i=new Promise(a(t.debounce));return b(this,Object.assign(i,t))}},R=h(s=>s),B=h(queueMicrotask),H=h(setTimeout),V=h(requestAnimationFrame),W=h(s=>requestAnimationFrame(()=>requestAnimationFrame(s))),Y=h(requestIdleCallback),J=(s=0)=>h(o=>setTimeout(o,s)),K=h((s,o)=>{s(),o.cancel()});export{w as Graph,f as QSA,N as asEl,L as batch,b as extendFunction,Y as idle,I as invoke,v as log,u as loop,W as next,G as onDom,K as once,h as orca,Q as perf,k as recur,y as sortEls,R as sync,H as task,B as then,V as tick,J as wait};
//# sourceMappingURL=index.js.map
